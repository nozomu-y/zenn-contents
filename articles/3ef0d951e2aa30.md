---
title: "k6 ã®å®Ÿè¡Œçµæœã‚’ Prometheus ã«ä¿å­˜ã—ã¦ Grafana ã§å¯è¦–åŒ–ã—ã¦ã¿ãŸ"
emoji: "ğŸ“ˆ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["k6", "prometheus", "grafana"]
published: true
---

# ã¯ã˜ã‚ã«

è² è·ãƒ†ã‚¹ãƒˆã®çµæœã‚’ãã‚Œã„ã«å¯è¦–åŒ–ã—ãŸããªã‚Šã€k6, Prometheus, Grafana ã®çµ„ã¿åˆã‚ã›ã§è² è·ãƒ†ã‚¹ãƒˆã®å®Ÿè¡ŒåŸºç›¤ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸã€‚è‡ªåˆ†ã®ç†è§£ã‚’æ·±ã‚ã‚‹ãŸã‚ã«ã‚‚ã€ãã®å†…å®¹ã‚’è¨˜äº‹ã«ã¾ã¨ã‚ã¦ãŠãã¾ã™ã€‚

## è² è·ãƒ†ã‚¹ãƒˆã¨ã¯

é–‹ç™ºç’°å¢ƒã§ã¯ãã¡ã‚“ã¨å‹•ã„ã¦ã„ãŸã‚µãƒ¼ãƒ“ã‚¹ã‚’ã„ã–æœ¬ç•ªç’°å¢ƒã«ãƒªãƒªãƒ¼ã‚¹ã—ãŸã¨ãã€ã‚¢ã‚¯ã‚»ã‚¹é›†ä¸­ã«ã‚ˆã‚ŠäºˆæœŸã›ã¬å•é¡ŒãŒç™ºç”Ÿã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ã‚ˆã†ãªå•é¡Œã¸ã®å¯¾ç­–ã¨ã—ã¦ã€ã‚µãƒ¼ãƒ“ã‚¹ã«æ„å›³çš„ã«è² è·ã‚’ã‹ã‘ã¦æ“¬ä¼¼çš„ã«ã‚¢ã‚¯ã‚»ã‚¹é›†ä¸­ã®çŠ¶æ…‹ã‚’ä½œã‚Šå‡ºã—ã€ã‚·ã‚¹ãƒ†ãƒ ã®æŒ¯ã‚‹èˆã„ã‚’è¦³æ¸¬ã™ã‚‹è² è·ãƒ†ã‚¹ãƒˆãŒç”¨ã„ã‚‰ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦æ½œåœ¨çš„ãªæ€§èƒ½ä¸Šã®å•é¡Œã‚’ç‰¹å®šã—ã€ã‚µãƒ¼ãƒ“ã‚¹ã®ä¿¡é ¼æ€§ã‚’é«˜ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## k6ã¨ã¯

[k6](https://k6.io/) ã¯ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®è² è·ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã§ã™ã€‚å®Ÿè£…ã«ã¯ Go è¨€èªãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å´ã®ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã¯ JavaScript ã§è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## Prometheusã¨ã¯

[Prometheus](https://prometheus.io/) ã¯ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã® CPU ä½¿ç”¨ç‡ãƒ»ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãªã©ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã—ã€æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è“„ç©ã—ã€ç›£è¦–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

åé›†ã—ãŸãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¯ Web UI ä¸Šã§é–²è¦§ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ãŒã€UI ã¯ç°¡æ˜“çš„ãªã‚‚ã®ã§æ©Ÿèƒ½ãŒå°‘ãªã„ãŸã‚ Grafana ã¨çµ„ã¿åˆã‚ã›ã¦ä½¿ã‚ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚

## Grafanaã¨ã¯

[Grafana](https://grafana.com/) ã¯ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ç›£è¦–ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚å¤–éƒ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¨é€£æºã—ã€ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å¯è¦–åŒ–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆãƒ»åˆ†æã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚Prometheus, Loki, Elasticsearch, InfluxDB, Postgres ãªã©ã€æ§˜ã€…ãªãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

# å®Ÿè£…ã—ã¦ã¿ã‚‹

## ç’°å¢ƒ

- Docker 4.27.1
- k6 0.49.0
- Prometheus 2.49.1
- Grafana 10.3.1

## ã‚·ãƒŠãƒªã‚ªã®ä½œæˆ

k6 ã§è² è·ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã€ã‚·ãƒŠãƒªã‚ªã‚’è¨˜è¿°ã—ãŸ JavaScript ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```js:scripts/sample.js
import http from "k6/http";
import { check, sleep } from "k6";

// Test configuration
export const options = {
  thresholds: {
    // Assert that 99% of requests finish within 3000ms.
    http_req_duration: ["p(99) < 3000"],
  },
  // Ramp the number of virtual users up and down
  stages: [
    { duration: "30s", target: 15 },
    { duration: "1m", target: 15 },
    { duration: "30s", target: 0 },
  ],
};

// Simulated user behavior
export default function () {
  let res = http.get("https://test-api.k6.io/public/crocodiles/1/");
  // Validate response status
  check(res, { "status was 200": (r) => r.status == 200 });
  sleep(1);
}
```

ã“ã®ã‚·ãƒŠãƒªã‚ªã¯ã€https://test-api.k6.io/public/crocodiles/1/ ã«å¯¾ã—ã¦ä¸‹å›³ã®ã‚ˆã†ã«ä»®æƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° (VUs) ã‚’å¢—æ¸›ã•ã›ãªãŒã‚‰è² è·ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã‚‚ã®ã§ã™ã€‚ã¾ãŸã€ã“ã®ã‚·ãƒŠãƒªã‚ªã§ã¯ 99% ä»¥ä¸Šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒ 3000ms ä»¥å†…ã«çµ‚äº†ã—ãŸå ´åˆã®ã¿æ­£å¸¸çµ‚äº†ã—ã¾ã™ã€‚

![](/images/k6-prometheus-grafana/k6-stages.png)

ç¶šã„ã¦ã€ã“ã®ã‚·ãƒŠãƒªã‚ªã«å¯¾ã—ã¦è² è·ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã« k6 ã®å®Ÿè¡Œç’°å¢ƒã‚’æº–å‚™ã—ã¾ã™ã€‚

## k6 ã‚³ãƒ³ãƒ†ãƒŠã®å®šç¾©

`docker-compose.yml` ã« k6 ã‚³ãƒ³ãƒ†ãƒŠã®å®šç¾©ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

```yml:docker-compose.yml
version: "3.8"

services:
  k6:
    image: grafana/k6:0.49.0
    ports:
      - "6565:6565"
    volumes:
      - type: bind
        source: "./scripts"
        target: "/scripts"
```

## è² è·ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

å…ˆã»ã©ä½œæˆã—ãŸã‚·ãƒŠãƒªã‚ªã‚’ã‚‚ã¨ã«ã€è² è·ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

ã¾ãšã€å®šç¾©ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ã¦èµ·å‹•ã—ã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ãŸå¾Œã« k6 ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã®ã§ `-d, --detach` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

```bash
docker compose up -d
```

ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã§ããŸã‚‰ k6 ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦è² è·ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
docker compose run k6 /scripts/sample.js
```

å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªçµæœãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚

![](/images/k6-prometheus-grafana/k6-result.png)

ç„¡äº‹è² è·ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ã—ã‹ã—ã€ã“ã®ã¾ã¾ã§ã¯çµæœã¯æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã•ã‚Œã‚‹ã ã‘ã§ã©ã“ã«ã‚‚ä¿å­˜ã•ã‚Œã¾ã›ã‚“ã€‚k6 ã®å®Ÿè¡Œçµæœã‚’ Prometheus ã«ä¿å­˜ã™ã‚‹ãŸã‚ã« Prometheus ã®ç’°å¢ƒã‚’æº–å‚™ã—ã¾ã™ã€‚

## Prometheus ã‚³ãƒ³ãƒ†ãƒŠã®å®šç¾©

`docker-compose.yml` ã« Prometheus ã‚³ãƒ³ãƒ†ãƒŠã®å®šç¾©ã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```diff yml:docker-compose.yml
  version: "3.8"

   services:
     k6:
       image: grafana/k6:0.49.0
       ports:
         - "6565:6565"
       volumes:
         - type: bind
           source: "./scripts"
           target: "/scripts"
+
+    prometheus:
+      image: prom/prometheus:v2.49.1
+      ports:
+        - "9090:9090"
+      volumes:
+        - type: bind
+          source: "./prometheus.yml"
+          target: "/etc/prometheus/prometheus.yml"
+        - type: bind
+          source: "./prometheus-data"
+          target: "/prometheus"
+      command:
+        - "--config.file=/etc/prometheus/prometheus.yml"
```

ã¾ãŸã€Prometheus ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã—ã¦ãŠããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

```sh
touch prometheus.yml
mkdir prometheus-data
```

## k6 ã®å®Ÿè¡Œçµæœã‚’ Prometheus ã«ä¿å­˜ã™ã‚‹

k6 ã®å®Ÿè¡Œçµæœã‚’ Prometheus ã«ä¿å­˜ã™ã‚‹ã«ã¯ã€ãã‚Œãã‚Œã®ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆã‚³ãƒ³ãƒ†ãƒŠï¼‰ã‚’ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã“ã§ã¯ã€ `k6-prometheus` ã¨ã„ã†åå‰ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã—ã€`k6` ã‚µãƒ¼ãƒ“ã‚¹ã¨ `prometheus` ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã—ã¾ã™ã€‚
ã¾ãŸã€k6 ã®å®Ÿè¡Œçµæœã‚’ Prometheus ã«æ›¸ãè¾¼ã‚€ãŸã‚ã« Prometheus ã® [Remote Write Receiver](https://prometheus.io/docs/prometheus/latest/feature_flags/#remote-write-receiver) ã‚’æœ‰åŠ¹ã«ã—ã¦ãŠãã¾ã™ã€‚

```diff yml:docker-compose.yml
  version: "3.8"

+ networks:
+   k6-prometheus:
+
  services:
    k6:
      image: grafana/k6:0.49.0
      ports:
        - "6565:6565"
      volumes:
        - type: bind
          source: "./scripts"
          target: "/scripts"
+     environment:
+       - K6_PROMETHEUS_RW_SERVER_URL=http://prometheus:9090/api/v1/write
+     networks:
+       - k6-prometheus

    prometheus:
      image: prom/prometheus:v2.49.1
      ports:
        - "9090:9090"
      volumes:
        - type: bind
          source: "./prometheus.yml"
          target: "/etc/prometheus/prometheus.yml"
        - type: bind
          source: "./prometheus-data"
          target: "/prometheus"
      command:
+       - "--web.enable-remote-write-receiver"
        - "--config.file=/etc/prometheus/prometheus.yml"
+     networks:
+       - k6-prometheus
```

æ›´æ–°ã—ãŸ `docker-compose.yml` ã®å†…å®¹ã‚’åæ˜ ã™ã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ç›´ã—ã¦èµ·å‹•ã—ã¾ã™ã€‚

```sh
docker compose up -d
```

k6 ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãã«ã¯ã€ `-o, --out` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã« `experimental-prometheus-rw` ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```sh
docker compose run k6 -o experimental-prometheus-rw /scripts/sample.js
```

http://localhost:9090 ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€è² è·ãƒ†ã‚¹ãƒˆã®çµæœã¨ã—ã¦å¾—ã‚‰ã‚Œã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç°¡å˜ã«å¯è¦–åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è² è·ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­ã® `k6_http_reqs_total` ã®æ¨ç§»ã‚’å¯è¦–åŒ–ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ç”»åƒã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

![](/images/k6-prometheus-grafana/prometheus-graph.png)

ã—ã‹ã—ã€å†’é ­ã§ã‚‚è¿°ã¹ãŸã‚ˆã†ã« Prometheus ã® UI ã¯ç°¡æ˜“çš„ã§æ©Ÿèƒ½ãŒå°‘ãªã„ãŸã‚ã€ä»Šå›ã¯å¾—ã‚‰ã‚ŒãŸãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ Grafana ã§å¯è¦–åŒ–ã—ã¾ã™ã€‚ã¾ãšã¯ Grafana ã®ç’°å¢ƒã‚’æº–å‚™ã—ã¾ã—ã‚‡ã†ã€‚

## Grafana ã‚³ãƒ³ãƒ†ãƒŠã®å®šç¾©

`docker-compose.yml` ã« Grafana ã®ã‚³ãƒ³ãƒ†ãƒŠå®šç¾©ã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```diff yml:docker-compose.yml
  version: "3.8"

  networks:
    k6-prometheus:

  services:
    k6:
      image: grafana/k6:0.49.0
      ports:
        - "6565:6565"
      volumes:
        - type: bind
          source: "./scripts"
          target: "/scripts"
      environment:
        - K6_PROMETHEUS_RW_SERVER_URL=http://prometheus:9090/api/v1/write
      networks:
        - k6-prometheus

    prometheus:
      image: prom/prometheus:v2.49.1
      ports:
        - "9090:9090"
      volumes:
        - type: bind
          source: "./prometheus.yml"
          target: "/etc/prometheus/prometheus.yml"
        - type: bind
          source: "./prometheus-data"
          target: "/prometheus"
      command:
        - "--web.enable-remote-write-receiver"
        - "--config.file=/etc/prometheus/prometheus.yml"
      networks:
        - k6-prometheus
+
+   grafana:
+     image: grafana/grafana:10.3.1
+     ports:
+       - "3000:3000"
+     volumes:
+       - type: bind
+         source: "./grafana"
+         target: "/etc/grafana/provisioning"
```

ã¾ãŸã€Grafana ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã—ã¦ãŠããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

```sh
mkdir grafana
```

## Grafana ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã« Prometheus ã‚’è¿½åŠ ã™ã‚‹

Grafana ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã« Prometheus ã‚’è¿½åŠ ã™ã‚‹ã«ã¯ã€å…ˆã»ã©ã¨åŒæ§˜ã«ãã‚Œãã‚Œã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã“ã§ã¯ã€ `prometheus-grafana` ã¨ã„ã†åå‰ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã—ã€ `prometheus` ã‚µãƒ¼ãƒ“ã‚¹ã¨ `grafana` ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã—ã¾ã™ã€‚

```diff yml:docker-compose.yml
  version: "3.8"

  networks:
    k6-prometheus:
+   prometheus-grafana:

  services:
    k6:
      image: grafana/k6:0.49.0
      ports:
        - "6565:6565"
      volumes:
        - type: bind
          source: "./scripts"
          target: "/scripts"
      environment:
        - K6_PROMETHEUS_RW_SERVER_URL=http://prometheus:9090/api/v1/write
      networks:
        - k6-prometheus

    prometheus:
      image: prom/prometheus:v2.49.1
      ports:
        - "9090:9090"
      volumes:
        - type: bind
          source: "./prometheus.yml"
          target: "/etc/prometheus/prometheus.yml"
        - type: bind
          source: "./prometheus-data"
          target: "/prometheus"
      command:
        - "--web.enable-remote-write-receiver"
        - "--config.file=/etc/prometheus/prometheus.yml"
      networks:
        - k6-prometheus
+       - prometheus-grafana

    grafana:
      image: grafana/grafana:10.3.1
      ports:
        - "3000:3000"
      volumes:
        - type: bind
          source: "./grafana"
          target: "/etc/grafana/provisioning"
+     networks:
+       - prometheus-grafana
```

æ›´æ–°ã—ãŸ `docker-compose.yml` ã®å†…å®¹ã‚’åæ˜ ã™ã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ç›´ã—ã¦èµ·å‹•ã—ã¾ã™ã€‚

```sh
docker compose up -d
```

http://localhost:3000 ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ Grafana ã®ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚åˆæœŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¦ãƒ¼ã‚¶ãƒãƒ¼ãƒ ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ã¨ã‚‚ã« `admin` ã§ã™ã€‚

![](/images/k6-prometheus-grafana/grafana-login.png)

ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨æ–°è¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¨­å®šã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚é©å½“ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã—ã‚‡ã†ã€‚

![](/images/k6-prometheus-grafana/grafana-password-update.png)

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ãŸã‚‰ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’è¿½åŠ ã—ã¾ã™ã€‚ã€ŒPrometheusã€ã§æ¤œç´¢ã‚’ã‹ã‘ã¦è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚

![](/images/k6-prometheus-grafana/grafana-add-datasource.png)

Prometheus server URL ã«ã¯ `http://prometheus:9090` ã‚’æŒ‡å®šã—ã¾ã™ã€‚

![](/images/k6-prometheus-grafana/grafana-datasource-setting.png)

è¨­å®šãŒå®Œäº†ã—ãŸã‚‰ç”»é¢ä¸‹éƒ¨ã®ã€ŒSave & Testã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¨­å®šã‚’å®Œäº†ã—ã¾ã™ã€‚

## ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ä½œæˆ

ä»Šå›ã¯ [k6 Prometheus Dashboard](https://grafana.com/grafana/dashboards/19665-k6-prometheus/) ã‚’ä½¿ã£ã¦ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã™ã€‚Grafana ã®ç”»é¢ã‹ã‚‰ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ã‚‡ã†ã€‚

è² è·ãƒ†ã‚¹ãƒˆã‚’å†åº¦å®Ÿè¡Œã—ãªãŒã‚‰ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨å„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒæ›´æ–°ã•ã‚Œã€ã‚°ãƒ©ãƒ•ãŒæç”»ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚

![](/images/k6-prometheus-grafana/grafana-dashboard.png)

Prometheus ã«ã¯ã“ã®ä»–ã«ã‚‚ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚Grafana ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã“ã¨ã§ã€è‡ªåˆ†ã®ã‚µãƒ¼ãƒ“ã‚¹ã«å¿…è¦ãªãƒ¡ãƒˆãƒªã‚¯ã‚¹ã ã‘ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

# ãŠã‚ã‚Šã«

ä»Šå›ã¯ Docker ã‚’ä½¿ã£ã¦ k6 ã§å®Ÿè¡Œã—ãŸè² è·ãƒ†ã‚¹ãƒˆã®çµæœã‚’ Prometheus ã«ä¿å­˜ã—ã€Grafana ã§å¯è¦–åŒ–ã—ã¦ã¿ã¾ã—ãŸã€‚ä»Šå›ã®å®Ÿè£…ã«ä½¿ç”¨ã—ãŸã‚³ãƒ¼ãƒ‰ã¯ GitHub ã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

https://github.com/nozomu-y/introduction-to-k6-prometheus-grafana
